<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>XCP Open Dispensers</title>

<style>
:root {
    --bg: #0e1117;
    --bg-alt: #161b22;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --border: #30363d;
    --link: #60a5fa;
    --button: #2563eb;
}

.light {
    --bg: #f9fafb;
    --bg-alt: #e5e7eb;
    --text: #111827;
    --muted: #4b5563;
    --border: #d1d5db;
    --link: #2563eb;
    --button: #1d4ed8;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 20px;
}

button {
    background: var(--button);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    margin-right: 8px;
}

button.secondary {
    background: #6b7280;
}

button.active {
    background: #16a34a;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 14px;
}

thead th {
    position: sticky;
    top: 0;
    background: var(--bg);
    z-index: 2;
}

tfoot td {
    position: sticky;
    bottom: 0;
    background: var(--bg-alt);
    z-index: 2;
    font-weight: 700;
}

th, td {
    padding: 8px 10px;
    border-bottom: 1px solid var(--border);
    text-align: right;
}

th {
    color: var(--muted);
    font-weight: 600;
}

th.addr, td.addr {
    text-align: left;
}

td.numeric {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

.highlight {
    background: rgba(31,41,55,0.35);
    font-weight: 700;
    border-radius: 4px;
}

a,
a:visited {
    color: var(--link);
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

.verified {
    color: #22c55e;
    font-size: 18px;
    text-align: center;
    cursor: help;
}

.multi {
    font-size: 18px;
    text-align: center;
    cursor: help;
}
</style>
</head>

<body>

<h2>
Dynamic list of open XCP dispensers, maintained by
<a href="https://x.com/niftyboss1" target="_blank">Niftyboss1</a>
</h2>

<button id="verifiedFilterBtn" class="secondary">Show Verified Only</button>
<button id="themeToggleBtn" class="secondary">Light mode</button>

<div style="margin-top:16px; margin-bottom:6px; color:var(--muted); line-height:1.5;">
    <p>
        To buy XCP, trigger these dispensers using a Counterparty wallet.
        (see list at <a href="https://counterparty.io" target="_blank">counterparty.io</a>)
    </p>
    <p>
        <strong>Important note:</strong> Experimental page, DYOR.
        Always cross-check with TokenScan and/or Horizon.
    </p>
</div>

<table>
<thead>
<tr>
    <th class="addr">Source Address</th>
    <th>Verified</th>
    <th>Multidispenser</th>
    <th>Give Remaining (XCP)</th>
    <th>Satoshirate</th>
    <th>URLs</th>
</tr>
</thead>

<tbody id="rows"></tbody>

<tfoot>
<tr>
    <td class="addr">Total</td>
    <td></td>
    <td></td>
    <td id="totalGiveRemaining" class="numeric">0</td>
    <td></td>
    <td id="lastUpdated" style="text-align:right; color:var(--muted); font-weight:500;">
        Last updated: —
    </td>
</tr>
</tfoot>
</table>

<script>
const CP_API = "https://api.counterparty.io:4000/v2";
const usNumber = new Intl.NumberFormat("en-US");

const VERIFIED_ADDRESSES = new Set([
    "bc1q2lucujpedcrjvzax4kgrpfhk92wqkhejr0g75k",
    "bc1qn9xq3txq3qcsfet5frvxvf8ch45dkw2fwmd76a",
    "111614QQVJUwgySi7re4eDx4i3knfa3wg",
    "1FDVTNiW4eWK5w7SDjsJVbRabjF3uDPJ6A",
    "14GJcX5x9GESu1scC5FvWTg6kz48AdR1ft",
    "bc1q0vep4hc2ljnuvmtehqk0qk0qujrlxpdu5yrkvc",
    "bc1qhw7atfkv9fuem3wywcys7et6gyj72jahwqqze7",
    "1Cs6iGVsP1KKwGMU71Cx9wmv89jAdBE6Ri",
    "bc1q7787j6msqczs58asdtetchl3zwe8ruj57p9r9y",
    "bc1q0wlpxctzv0fm9qprrcplmn9t93hkr9ydupf8n0",
    "bc1qcxse4z2rvltw3r764puq52vc9cgv5dv2nmruz8",
    "1H8mGPcvv2Ess3jxCEsTd4B4gkYiia9Ubq",
    "bc1q8888888p9ffr9dwjs9g35fv6hwfqahfl8nw7l6"
]);

const MULTIDISPENSERS = new Set([
    "bc1qn9xq3txq3qcsfet5frvxvf8ch45dkw2fwmd76a",
    "bc1q0vep4hc2ljnuvmtehqk0qk0qujrlxpdu5yrkvc",
    "bc1q8888888p9ffr9dwjs9g35fv6hwfqahfl8nw7l6"
]);

let allDispensers = [];
let showVerifiedOnly = false;

document.getElementById("verifiedFilterBtn").onclick = toggleVerifiedFilter;
document.getElementById("themeToggleBtn").onclick = toggleTheme;

function applyTheme(theme) {
    document.body.classList.toggle("light", theme === "light");
    localStorage.setItem("theme", theme);
    document.getElementById("themeToggleBtn").textContent =
        theme === "light" ? "Dark mode" : "Light mode";
}

function toggleTheme() {
    const current = document.body.classList.contains("light") ? "light" : "dark";
    applyTheme(current === "light" ? "dark" : "light");
}

applyTheme(localStorage.getItem("theme") || "dark");

// Auto-load after 1 second
setTimeout(loadDispensers, 1000);

async function loadDispensers() {
    const res = await fetch(
        `${CP_API}/assets/XCP/dispensers?status=0&asset=XCP&limit=15000`
    );
    const json = await res.json();

    allDispensers = (json.result || [])
        .filter(d =>
            d.give_quantity === 100000000 &&
            (d.give_remaining || 0) >= 10 * 1e8
        )
        .sort((a, b) => a.satoshirate - b.satoshirate);

    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, "0");
    const dd = String(now.getDate()).padStart(2, "0");
    document.getElementById("lastUpdated").textContent =
        `Last updated: ${yyyy}-${mm}-${dd}`;

    renderTable();
}

function toggleVerifiedFilter() {
    showVerifiedOnly = !showVerifiedOnly;
    const btn = document.getElementById("verifiedFilterBtn");
    btn.classList.toggle("active", showVerifiedOnly);
    btn.textContent = showVerifiedOnly
        ? "Showing Verified Only"
        : "Show Verified Only";
    renderTable();
}

function renderTable() {
    const rows = document.getElementById("rows");
    rows.innerHTML = "";

    let totalGiveRemaining = 0;

    allDispensers
        .filter(d => !showVerifiedOnly || VERIFIED_ADDRESSES.has(d.source))
        .forEach(d => {
            const giveXCP = Math.floor(d.give_remaining / 1e8);
            totalGiveRemaining += giveXCP;

            const shortAddr = d.source.length > 17
                ? d.source.slice(0,9) + "..." + d.source.slice(-5)
                : d.source;

            rows.insertAdjacentHTML("beforeend", `
<tr>
<td class="addr">${shortAddr}</td>

<td class="verified" title="This is a Niftyboss1 verified dispenser">
    ${VERIFIED_ADDRESSES.has(d.source) ? "✔️" : ""}
</td>

<td class="multi" title="This is a multidispenser (XCP, PEPECASH)">
    ${MULTIDISPENSERS.has(d.source) ? "&#x1F381;" : ""}
</td>

<td class="numeric highlight">
    ${usNumber.format(giveXCP)}
</td>

<td class="numeric">
    ${usNumber.format(d.satoshirate)}
</td>

<td class="numeric">
    <a href="https://tokenscan.io/tx/${d.tx_hash}" target="_blank">TokenScan</a>
    |
    <a href="https://horizon.market/explorer/tx/${d.tx_hash}" target="_blank">Horizon</a>
</td>
</tr>
            `);
        });

    document.getElementById("totalGiveRemaining").textContent =
        usNumber.format(totalGiveRemaining);
}
</script>

</body>
</html>
